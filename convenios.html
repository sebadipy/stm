<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beneficios y Convenios STM</title>
    <!-- Cargamos la nueva tipografía: Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Incluimos Tailwind CSS para un diseño moderno y responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Usamos Font Awesome 6 para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <style>
        /* Configuraciones personalizadas de Tailwind (Paleta STM) */
        :root {
            --color-stm-purple: #5A377B; /* Púrpura principal (Fuerte) */
            --color-stm-teal: #34B3C5;   /* Turquesa (Acento Vibrante - Resalte) */
            --color-bg-light: #f7f7f8;   /* Fondo muy claro */
            --color-card-bg: #ffffff;    /* Fondo de tarjeta blanco puro */
            
            /* Colores Adicionales para Rubros (Para los iconos y texto) */
            --color-rubro-green: #2ecc71;
            --color-rubro-blue: #3498db;
            --color-rubro-orange: #e67e22;
            --color-rubro-red: #e74c3c;
            --color-rubro-pink: #f7389c;
            --color-rubro-yellow: #f1c40f;
            --color-rubro-indigo: #8e44ad;
            --color-rubro-cyan: #1abc9c;
            --color-rubro-brown: #964B00;
        }

        /* ************************************************* */
        /* CORRECCIÓN CRÍTICA DE ALTURA PARA EL EFECTO FLIP */
        /* ************************************************* */
        html, body {
            height: 100%; 
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--color-bg-light);
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 480px; 
            margin: 0 auto;
            height: 100%; 
            background-color: var(--color-card-bg); 
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1); 
            display: flex;
            flex-direction: column;
        }
        
        .content-area {
            flex: 1; 
            position: relative;
            overflow: hidden; 
            background-color: var(--color-card-bg);
        }

        /* ==================================== */
        /* CSS para el Efecto FLIP 3D */
        /* ==================================== */
        .flip-container {
            width: 100%;
            height: 100%; 
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.4, 0.2, 0.2, 1); /* Curva de transición más dinámica */
        }
        
        .flip-container.flipped {
            transform: rotateY(180deg);
        }

        .flip-face {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%; 
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            overflow-y: auto; 
            padding-bottom: 1rem; 
        }

        .back-face {
            transform: rotateY(180deg);
            padding: 1rem; 
        }

        /* ==================================== */
        /* Estilos de Rubro Tile (CRÍTICO) */
        /* ==================================== */
        
        .rubro-tile {
            transition: all 0.3s ease;
            cursor: pointer;
            border-radius: 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); /* Sombra más sutil */
            background-color: var(--color-card-bg);
            padding: 1rem 0.5rem;
            text-align: center;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border: 2px solid #e5e7eb; /* Borde gris suave por defecto */
        }
        
        .rubro-tile:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }
        
        /* ESTILO PARA EL BOTÓN DE RUBRO SELECCIONADO (Acento STM Teal) */
        .rubro-tile.active {
            border-color: var(--color-stm-teal);
            box-shadow: 0 0 15px rgba(52, 179, 197, 0.6), 0 0 0 3px rgba(52, 179, 197, 0.3); /* Resalte con sombra exterior */
            transform: scale(1.02); /* Pequeño efecto de zoom */
        }
        
        .rubro-icon-bg {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            margin-left: auto;
            margin-right: auto;
            transition: all 0.3s ease;
        }

        .stm-logo-header {
            width: 36px;
            height: 36px;
            object-fit: contain;
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* Estilos de las tarjetas (Acordeón) y Rubros (Mantengo el resto) */
        .convenio-card {
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
            border: 1px solid #e5e7eb;
            box-shadow: 0 6px 15px -3px rgba(0, 0, 0, 0.08); 
            border-radius: 1rem; 
            overflow: hidden;
            background-color: var(--color-card-bg);
        }
        
        .convenio-card:hover, .convenio-card.open {
            transform: translateY(-3px); 
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.15);
            border-color: var(--color-stm-teal); 
        }
        
        .rubro-tag {
            transition: all 0.2s ease;
            background-color: var(--color-stm-purple); 
            box-shadow: 0 2px 8px rgba(90, 55, 123, 0.4); 
        }

        .convenio-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
            padding: 0 1.25rem;
            background-color: #ffffff;
        }
        
        .convenio-card.open .convenio-content {
            max-height: 1000px; 
            padding: 1rem 1.25rem 1.5rem; 
        }

        .chevron {
            transition: transform 0.4s ease-out; 
            color: var(--color-stm-teal); 
            font-size: 1rem;
        }
        .convenio-card.open .chevron {
            transform: rotate(180deg);
        }

        .filter-container {
            padding: 0 1rem 1rem 1rem;
        }
    </style>
</head>
<body>

    <!-- Contenedor Principal que simula la pantalla de un móvil -->
    <div class="app-container">
        
        <!-- HEADER / Barra de Navegación Estilo App (ESTÁTICO, NO GIRA) -->
        <header class="p-5 bg-[var(--color-stm-purple)] text-white shadow-xl flex-shrink-0">
            <div class="flex items-center">
                <!-- LOGO STM (Imagen subida por el usuario) -->
                <img src="http://googleusercontent.com/image_generation_content/0" 
                     onerror="this.onerror=null; this.src='https://placehold.co/36x36/5A377B/FFFFFF?text=STM';"
                     alt="Logo STM" 
                     class="stm-logo-header mr-3">
                     
                <!-- Usamos 'font-extrabold' y 'tracking-tight' de Poppins -->
                <h1 class="text-2xl font-extrabold tracking-tight">
                    BENEFICIOS STM
                </h1>
            </div>
            <p class="text-indigo-200 text-sm mt-1 font-light">
                Convenios exclusivos y llamativos para vos.
            </p>
        </header>

        <!-- AREA DE CONTENIDO (ESTE CONTENEDOR ES EL QUE GIRA) -->
        <div class="content-area">
            <div id="flipContainer" class="flip-container">
                
                <!-- CARA FRONTAL: GRID DE RUBROS -->
                <div id="frontFace" class="flip-face front-face pt-4">
                    <div class="filter-container">
                        <!-- Título actualizado: Explorar Rubros -->
                        <h2 class="text-lg font-bold text-gray-800 pt-1 mb-3 px-1">
                            <i class="fas fa-cubes text-[var(--color-stm-teal)] mr-2"></i> Explorar Rubros
                        </h2>
    
                        <!-- Grid para mostrar los rubros como tarjetas -->
                        <div id="rubroGrid" class="grid grid-cols-3 gap-3 mb-6">
                            <div class="col-span-3 text-center p-4 text-gray-500" id="rubroGridLoading">Cargando rubros...</div>
                        </div>
                    </div>
                </div>
                
                <!-- CARA TRASERA: LISTA DE CONVENIOS -->
                <div id="backFace" class="flip-face back-face">
                    
                    <!-- Botón para volver a la lista de Rubros (Back Button) -->
                    <button id="backToRubros" 
                            class="mb-4 flex items-center text-sm font-semibold text-white bg-[var(--color-stm-teal)] hover:bg-[#2092a4] active:bg-[#1a7080] transition duration-150 py-2 px-4 rounded-full shadow-lg self-start">
                        <i class="fas fa-arrow-left mr-2"></i> Volver a Rubros
                    </button>
                    
                    <h2 class="text-xl font-bold text-gray-800 mb-4 px-1" id="conveniosTitle">
                        Convenios Destacados:
                    </h2>
        
                    <div id="conveniosList" class="space-y-4 pb-12 flex-grow">
                        <!-- Spinner de carga inicial -->
                        <div id="loadingSpinner" class="text-center p-12 bg-gray-100 rounded-2xl shadow-inner">
                            <i class="fas fa-spinner fa-spin text-5xl text-[var(--color-stm-teal)]"></i>
                            <p class="mt-4 text-gray-700 font-bold text-lg">Cargando beneficios...</p>
                        </div>
                        
                        <!-- Aquí se cargarán dinámicamente los convenios -->
                    </div>
        
                    <!-- Mensaje de no resultados (oculto por defecto) -->
                    <div id="noResults" class="hidden text-center p-10 bg-red-50 rounded-2xl shadow-md border-2 border-red-300 mt-6 flex-shrink-0">
                        <i class="fas fa-search-minus text-4xl text-red-500"></i>
                        <p class="mt-4 text-red-700 font-bold">¡Uy! No hay convenios en este rubro.</p>
                        <p class="text-sm text-red-600">Probá seleccionando "TODOS" en los rubros de arriba.</p>
                    </div>
                    
                </div>
            </div>
        </div>
        
        <!-- FOOTER (ESTÁTICO, NO GIRA) -->
        <footer class="p-4 text-center text-xs text-gray-500 border-t mt-auto bg-gray-50 flex-shrink-0">
            <p>&copy; 2024 STM - Sindicato de Trabajadores Municipales</p>
        </footer>
    </div>

    <script>
        // La URL de tu AppScript que devuelve los datos de los convenios
        // NOTA: Reemplazar con la URL real de tu AppScript
        const APPSSCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzgD9-ggtZjFyK7I4FfwLETVtj5TUBvQIZWF5om5yAKLhj4BuerpbdHN-3PnTfLDzdxBA/exec'; 

        const flipContainer = document.getElementById('flipContainer');
        const conveniosList = document.getElementById('conveniosList');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const rubroGrid = document.getElementById('rubroGrid');
        const rubroGridLoading = document.getElementById('rubroGridLoading');
        const noResults = document.getElementById('noResults');
        const conveniosTitle = document.getElementById('conveniosTitle');
        const backButton = document.getElementById('backToRubros');
        
        let allConvenios = []; // Almacenará todos los convenios cargados
        let uniqueRubros = new Set(); // Almacenará los rubros únicos
        let currentFilter = 'TODOS'; // Filtro actual seleccionado

        document.addEventListener('DOMContentLoaded', () => {
            fetchConvenios();
            
            // Asignar el evento para volver a los rubros
            backButton.addEventListener('click', () => {
                flipTo('front');
            });
        });
        
        /**
         * Simula un simple fetch con reintento y backoff exponencial (para manejar posibles fallos de red)
         */
        async function fetchWithRetry(url, options = {}, maxRetries = 3, delay = 1000) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        throw new Error(`HTTP Error: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    if (i === maxRetries - 1) {
                        throw error;
                    }
                    // Espera con backoff exponencial
                    await new Promise(resolve => setTimeout(resolve, delay * (2 ** i)));
                }
            }
        }
        
        /**
         * Controla el giro de la pantalla (front: rubros, back: convenios).
         */
        function flipTo(face) {
            if (face === 'back') {
                flipContainer.classList.add('flipped');
            } else {
                flipContainer.classList.remove('flipped');
            }
            // Asegurarse de que el scroll se resetee al cambiar de cara
            const activeFace = face === 'front' ? document.getElementById('frontFace') : document.getElementById('backFace');
            activeFace.scrollTop = 0;
        }

        /**
         * Carga los convenios desde el AppScript.
         */
        async function fetchConvenios() {
            loadingSpinner.classList.remove('hidden');
            conveniosList.innerHTML = '';
            noResults.classList.add('hidden');
            rubroGridLoading.classList.remove('hidden');

            try {
                const response = await fetchWithRetry(APPSSCRIPT_URL + '?action=READ_ALL');
                const responseText = await response.text();
                
                let data = {};
                try {
                    data = JSON.parse(responseText);
                } catch(e) {
                     throw new Error('Respuesta del servidor no es JSON válida o estructura inesperada.');
                }
                
                const dataArray = data.convenios || data.novedades; 
                
                if (data.status === 'success' && Array.isArray(dataArray)) {
                    allConvenios = dataArray.filter(c => (c.ACTIVO || '').toUpperCase().trim() === 'SI');
                    
                    // 1. Obtener y renderizar los rubros en la grilla (Front Face)
                    populateRubroGrid(allConvenios);
                    
                    // 2. Renderizar todos los convenios por defecto (Back Face)
                    filterConvenios(currentFilter, false); // No girar en la carga inicial

                } else {
                    throw new Error(data.message || 'Error: Formato de datos inesperado o status no es "success".');
                }
            } catch (error) {
                console.error('Error al cargar convenios:', error);
                
                // Mostrar el error en la cara frontal si no se pudo cargar
                document.getElementById('frontFace').innerHTML = `
                    <div class="alert bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg shadow-md m-4" role="alert">
                        <h4 class="font-bold">¡Error de Conexión!</h4>
                        <p>No se pudieron cargar los convenios. Detalle: ${error.message}</p>
                    </div>
                `;
                // Si la carga falla, asegúrate de que el spinner de rubros no se muestre
                rubroGridLoading.classList.add('hidden');
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        }

        /**
         * Rellena el grid de rubros únicos y añade la opción TODOS.
         */
        function populateRubroGrid(convenios) {
            rubroGridLoading.classList.add('hidden');
            rubroGrid.innerHTML = '';
            uniqueRubros = new Set();

            convenios.forEach(c => {
                if (c.rubro) {
                    uniqueRubros.add(c.rubro.toUpperCase().trim());
                }
            });
            
            let rubrosArray = Array.from(uniqueRubros).sort();

            // Agregar la opción "TODOS" al principio
            if (!rubrosArray.includes('TODOS')) {
                rubrosArray.unshift('TODOS');
            }

            renderRubroGrid(rubrosArray);
        }
        
        /**
         * Devuelve un color de acento para el tile del rubro.
         */
        function getRubroColor(rubro) {
            const r = rubro.toUpperCase().trim();
            // Mapeo simple de colores para los rubros
            switch (r) {
                case 'TODOS':
                    return { color: 'var(--color-stm-teal)', bg: 'rgba(52, 179, 197, 0.1)' }; // Turquesa STM
                case 'SALUD':
                case 'MEDICINA':
                    return { color: 'var(--color-rubro-red)', bg: 'rgba(231, 76, 60, 0.1)' }; 
                case 'EDUCACION':
                case 'FORMACION':
                    return { color: 'var(--color-rubro-blue)', bg: 'rgba(52, 152, 219, 0.1)' };
                case 'TURISMO':
                case 'VIAJES':
                    return { color: 'var(--color-rubro-green)', bg: 'rgba(46, 204, 113, 0.1)' };
                case 'DEPORTES':
                case 'GIMNASIOS':
                    return { color: 'var(--color-stm-purple)', bg: 'rgba(90, 55, 123, 0.1)' }; 
                case 'COMERCIO':
                case 'COMPRAS':
                    return { color: 'var(--color-rubro-orange)', bg: 'rgba(230, 126, 34, 0.1)' };
                case 'GASTRONOMIA':
                case 'COMIDA':
                    return { color: 'var(--color-rubro-yellow)', bg: 'rgba(241, 196, 15, 0.1)' };
                case 'SERVICIOS':
                    return { color: 'var(--color-rubro-indigo)', bg: 'rgba(142, 68, 173, 0.1)' }; 
                case 'BELLEZA':
                case 'ESTETICA':
                    return { color: 'var(--color-rubro-pink)', bg: 'rgba(247, 56, 156, 0.1)' };
                case 'FINANZAS':
                    return { color: 'var(--color-rubro-cyan)', bg: 'rgba(26, 188, 156, 0.1)' }; // Cyan
                case 'LEGAL':
                    return { color: 'var(--color-rubro-brown)', bg: 'rgba(150, 75, 0, 0.1)' }; // Marrón
                case 'OTROS': // Por si hay rubros que caen fuera de los principales
                    return { color: '#7f8c8d', bg: 'rgba(127, 140, 141, 0.1)' }; // Gris plomo
                default:
                    return { color: 'var(--color-stm-teal)', bg: 'rgba(52, 179, 197, 0.1)' }; // Default Turquesa STM
            }
        }
        
        /**
         * Renderiza la grilla de tarjetas de rubros.
         */
        function renderRubroGrid(rubros) {
            rubroGridLoading.classList.add('hidden');
            rubroGrid.innerHTML = '';
            
            rubros.forEach(rubro => {
                const isTodos = rubro === 'TODOS';
                const rubroName = isTodos ? 'TODOS' : rubro;
                const rubroIcon = getRubroIcon(rubro, true); // Usa el icono de Tile
                const rubroStyle = getRubroColor(rubro);

                const card = document.createElement('div');
                card.className = 'col-span-1';
                card.innerHTML = `
                    <div class="rubro-tile ${rubro === currentFilter ? 'active' : ''}" data-rubro="${rubro}">
                        <div class="rubro-icon-bg" 
                             style="color: ${rubroStyle.color}; background-color: ${rubroStyle.bg}; border: 2px solid ${rubroStyle.color};">
                            ${rubroIcon}
                        </div>
                        <!-- Texto del rubro ahora usa el color del rubroStyle -->
                        <p class="text-[0.65rem] font-bold uppercase leading-tight mt-1" 
                           style="color: ${rubroStyle.color};">
                           ${rubroName}
                        </p>
                    </div>
                `;
                
                // Asigna la función de filtro al hacer click
                card.querySelector('.rubro-tile').onclick = function() {
                    currentFilter = rubro;
                    filterConvenios(rubro, true); // Girar la pantalla
                    // Actualiza la clase activa y los estilos de borde
                    document.querySelectorAll('.rubro-tile').forEach(tile => tile.classList.remove('active'));
                    this.classList.add('active');
                };
                
                rubroGrid.appendChild(card);
            });
        }
        
        /**
         * Filtra los convenios basados en la selección del rubro y actualiza la vista.
         * @param {string} selectedRubro - Rubro seleccionado.
         * @param {boolean} shouldFlip - Indica si debe realizarse la animación de giro.
         */
        function filterConvenios(selectedRubro, shouldFlip = false) {
            currentFilter = selectedRubro;
            let filteredConvenios = [];

            if (selectedRubro === 'TODOS') {
                filteredConvenios = allConvenios;
                conveniosTitle.textContent = "Convenios Destacados:";
            } else {
                filteredConvenios = allConvenios.filter(c => 
                    (c.rubro || '').toUpperCase().trim() === selectedRubro
                );
                conveniosTitle.textContent = `Convenios en: ${selectedRubro}`;
            }

            renderConvenios(filteredConvenios);
            
            if (shouldFlip) {
                flipTo('back');
            }
        }

        /**
         * Devuelve un icono de Font Awesome basado en el nombre del rubro.
         * isTile=true usa un icono más temático para la grilla
         */
        function getRubroIcon(rubro, isTile = false) {
            const r = rubro.toUpperCase().trim();
            
            // Iconos ajustados para ser más representativos
            switch (r) {
                case 'TODOS':
                    return '<i class="fas fa-layer-group"></i>'; // Icono para mostrar todos los grupos
                case 'SALUD':
                case 'MEDICINA':
                    return isTile ? '<i class="fas fa-hospital-user"></i>' : '<i class="fas fa-heart-pulse mr-1"></i>'; 
                case 'EDUCACION':
                case 'FORMACION':
                    return isTile ? '<i class="fas fa-graduation-cap"></i>' : '<i class="fas fa-book-open-reader mr-1"></i>'; 
                case 'TURISMO':
                case 'VIAJES':
                    return isTile ? '<i class="fas fa-plane"></i>' : '<i class="fas fa-map-marked-alt mr-1"></i>'; 
                case 'DEPORTES':
                case 'GIMNASIOS':
                    return isTile ? '<i class="fas fa-dumbbell"></i>' : '<i class="fas fa-running mr-1"></i>'; 
                case 'COMERCIO':
                case 'COMPRAS':
                    return isTile ? '<i class="fas fa-store-alt"></i>' : '<i class="fas fa-shopping-basket mr-1"></i>'; 
                case 'GASTRONOMIA':
                case 'COMIDA':
                    return isTile ? '<i class="fas fa-pizza-slice"></i>' : '<i class="fas fa-utensils mr-1"></i>'; 
                case 'SERVICIOS':
                    return isTile ? '<i class="fas fa-hand-holding-box"></i>' : '<i class="fas fa-screwdriver-wrench mr-1"></i>'; // Caja de servicio
                case 'BELLEZA':
                case 'ESTETICA':
                    return isTile ? '<i class="fas fa-spa"></i>' : '<i class="fas fa-cut mr-1"></i>'; 
                case 'FINANZAS':
                    return isTile ? '<i class="fas fa-piggy-bank"></i>' : '<i class="fas fa-sack-dollar mr-1"></i>'; 
                case 'LEGAL':
                    return isTile ? '<i class="fas fa-balance-scale"></i>' : '<i class="fas fa-gavel mr-1"></i>'; 
                default:
                    // Nuevo icono por defecto, no la estrella
                    return isTile ? '<i class="fas fa-handshake"></i>' : '<i class="fas fa-handshake mr-1"></i>'; 
            }
        }

        /**
         * Renderiza la lista de convenios en formato de acordeón.
         */
        function renderConvenios(convenios) {
            conveniosList.innerHTML = '';
            
            // Cierra todas las tarjetas abiertas antes de renderizar (limpieza visual)
            document.querySelectorAll('.convenio-card.open').forEach(openCard => {
                openCard.classList.remove('open');
            });
            
            if (convenios.length === 0) {
                noResults.classList.remove('hidden');
                conveniosList.classList.add('hidden'); // Ocultar el contenedor de lista si no hay resultados
                return;
            }
            noResults.classList.add('hidden');
            conveniosList.classList.remove('hidden');

            convenios.forEach(convenio => {
                const rubro = (convenio.rubro || 'SIN RUBRO').toUpperCase().trim();
                const titulo = convenio.titulo || 'Convenio sin Título';
                const detalle = (convenio.detalle || 'Detalle no especificado.').replace(/\n/g, '<br>'); 
                const rubroIcon = getRubroIcon(rubro, false); // Usamos el icono de lista (no tile)

                const card = document.createElement('div');
                card.className = 'convenio-card'; 

                // Asigna la función de toggling al hacer click en la tarjeta
                card.onclick = function() {
                    toggleConvenio(this);
                };

                // El convenio-header debe tener padding que estaba en el contenedor anterior
                card.innerHTML = `
                    <div class="p-4 flex items-center justify-between hover:bg-gray-50 active:bg-gray-100 transition duration-150">
                        <!-- Lado Izquierdo: Rubro y Título -->
                        <div class="flex-1 min-w-0 pr-4">
                            <!-- Tag Púrpura Fuerte -->
                            <span class="rubro-tag inline-block px-3 py-1 text-xs font-bold uppercase tracking-wider rounded-full text-white mb-2 shadow-lg">
                                ${rubroIcon} ${rubro} 
                            </span>
                            <!-- Título con más peso tipográfico -->
                            <h2 class="text-xl font-extrabold text-gray-900">${titulo}</h2>
                        </div>
                        
                        <!-- Lado Derecho: Icono de Despliegue Turquesa -->
                        <div class="flex-shrink-0">
                            <i class="fas fa-chevron-down chevron text-gray-400"></i>
                        </div>
                    </div>
                    
                    <!-- Contenido Desplegable (Detalle) -->
                    <div class="convenio-content">
                        <div class="text-base text-gray-700 leading-relaxed">
                            <!-- Detalle del beneficio con color de acento Púrpura -->
                            <h3 class="font-bold text-[var(--color-stm-purple)] mb-3 border-b-2 border-gray-100 pb-1">Detalles y Beneficios:</h3>
                            <p>${detalle}</p>
                        </div>
                    </div>
                `;
                conveniosList.appendChild(card);
            });
        }
        
        /**
         * Abre o cierra la tarjeta de convenio y cierra las otras abiertas.
         */
        function toggleConvenio(card) {
            const isOpen = card.classList.contains('open');

            // 1. Cerrar todas las otras tarjetas abiertas
            document.querySelectorAll('.convenio-card.open').forEach(openCard => {
                if (openCard !== card) {
                    openCard.classList.remove('open');
                }
            });

            // 2. Abrir/Cerrar la tarjeta actual
            if (!isOpen) {
                card.classList.add('open');
            } else {
                card.classList.remove('open');
            }
        }
    </script>
</body>
</html>